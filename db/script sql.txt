USE 'uniticket';

CREATE PROCEDURE createUser
	@username VARCHAR(45),
	@password VARCHAR(45),
	@email VARCHAR(45)
AS
BEGIN
	INSERT INTO 'User' ('username', 'password', 'email', 'regDate')
	VALUES ('@username', '@password', '@email', CURDATE());
END


CREATE PROCEDURE logIn
	@username VARCHAR(45),
	@password VARCHAR(45)
AS
BEGIN
	DECLARE @id INT;
	DECLARE @hash BINARY(32);
	
	SELECT @id = idUser
		FROM 'User'
		WHERE 'User'.'username' = '@username' AND 
		'User'.'password' = '@password';
	IF COUNT(@id) = 1
	BEGIN
		@hash = HASHBYTES('SHA2_256', CONVERT(INT, CURDATE()) + @id);
		UPDATE 'User' SET 'sessionId' = @hash WHERE 'User'.'idUser' = @id;
		RETURN @hash;
	END
	ELSE
	BEGIN
		return 0;
	END
END

CREATE PROCEDURE logOut
	@sessionId BINARY(32)
AS
BEGIN
	UPDATE 'User' SET 'sessionId' = 0 WHERE 'User'.'sessionId' = @sessionId;
END

CREATE PROCEDURE getNotification
	@sessionId BINARY(32)
AS
	SELECT * FROM 'Notice'
	WHERE 